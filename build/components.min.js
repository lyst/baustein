!function(a,b){"function"==typeof define&&define.amd?define(b):a.components=b()}(this,function(){function a(a){return Object.prototype.toString.call(a).match(/\[object (.*?)\]/)[1].toLowerCase()}function b(b){return"object"===a(b)}function c(b){return"function"===a(b)}function d(a){return a&&(1===a.nodeType||9===a.nodeType)}function e(b){return"string"===a(b)}function f(){return this}function g(a){return a.replace(/\-(.)/g,function(a,b){return b.toUpperCase()})}function h(a){return B.call(arguments,1).forEach(function(c){if(b(c))for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])}),a}function i(a,b){if(E)return E(a).closest(b)[0];for(;a&&a!==A.body;){if(j(a,b))return a;a=a.parentElement}return null}function j(a,b){var c="MatchesSelector",d=a["webkit"+c]||a["moz"+c]||a["ms"+c]||a["o"+c]||a.matchesSelector||a.matches;return d.call(a,b)}function k(a){var b,c=[];if(a===z||a===A)return[];for(;d(a);)b=a.getAttribute(J),b&&G[b]&&c.push(G[b]),a=a.parentElement;return c}function l(a){var b,c;if(!d(a))return null;if(b=a.getAttribute("is"),c=a.getAttribute(J),!b)return null;if(c)return G[c];if(!F[b])throw Error("No component has been registered with name "+b);return new F[b](a)}function m(a,b){var d,e=B.call(arguments,2),f=0;if(o(a)&&(a=[a]),!a)return this;for(d=a.length;d>f;f++)c(a[f][b])&&a[f][b].apply(a[f],e);return this}function n(a){for(var b,c,d={},e=0;e<a.attributes.length;e++){b=g(a.attributes[e].name),c=a.attributes[e].value;try{c=JSON.parse(c)}catch(f){}d[b]=c}return d}function o(a){return a instanceof y}function p(a,b){var c,d,e,f,g,h,j,l,m,n,p,q=a.target,r=o(q),s=r?q.name:null,t=a.type;for(b||(b=k(r?q.el:q)),l=0,n=b.length;n>l;l++)if(c=b[l],d=c._events)for(m=0,p=d.length;p>m;m++)g=d[m][0],f=d[m][1],h=d[m][2],g===t&&(f?r?f===s&&h.call(c,a):(e=i(q,f),e&&h.call(c,a,e)):h.call(c,a));if(j=H[t])for(l=0,n=j.length;n>l;l++)j[l].fn.call(j[l].ctx,a,A.body)}function q(a){a=d(a)?a:A.body;var b,c=B.call(a.querySelectorAll("[is]"));return c.unshift(a),c.reduce(function(a,c){return b=l(c),b&&a.push(b),a},[])}function r(a,c){var d,f;if(b(a)&&(c=a,a=c.name),!e(a)||!a)throw Error('"'+a+'" is not a valid component name');if(F[a])throw Error("A component called "+a+" already exists");return c=c||{},d=function(){y.apply(this,arguments)},f=function(){},f.prototype=y.prototype,d.prototype=new f,d.prototype.name=a,h(d.prototype,c),F[a]=d,d}function s(a){x(a),F[a]=null}function t(){var a,b;for(a in K)b=-1!==["resize","scroll"].indexOf(a)?window:A.body,b.addEventListener(a,p,!!K[a])}function u(){q(),t()}function v(a){return w(a)[0]}function w(a){var b=[];for(var c in G)G[c]&&G[c].name===a&&b.push(G[c]);return b}function x(a){return w(a).forEach(function(a){a.destroy()}),this}function y(a,d){1===arguments.length&&b(a)&&(d=a,a=this.createRootElement()),arguments.length||(a=this.createRootElement()),this._id=I++,G[this._id]=this,this.el=a,E&&(this.$el=E(a)),this.options=h({},c(this.defaultOptions)?this.defaultOptions():this.defaultOptions,n(this.el),d),this.options.template&&(this.template=this.options.template),a.setAttribute("is",this.name),a.setAttribute(J,this._id),this._events=[],this.init(),this.setupEvents(this.registerEvent.bind(this)),this.render()}var z=window,A=z.document,B=[].slice,C=[].filter,D=[].map,E=z.jQuery||z.Zepto||z.$,F={},G={},H={},I=1,J="data-component-id",K={click:!1,dblclick:!1,mousedown:!1,mouseup:!1,mousemove:!1,mouseleave:!0,mouseenter:!0,touchstart:!1,touchmove:!1,touchend:!1,keyup:!1,keydown:!1,error:!0,blur:!0,focus:!0,scroll:!0,submit:!0,change:!0,resize:!0,load:!0};return y.prototype={name:"",tagName:"div",template:null,init:function(){return this},setupEvents:f,render:function(){var a=this.template,b=c(a),d=e(a);return(b||d)&&(this.el.innerHTML=b?a(this):a,this.parse()),this},parse:function(){return q(this.el),this},emit:function(a,b,c){b=b||{},b.target=b.target||this,b.type=a,b.customEvent=!0,p(b,c)},appendTo:function(a){return(a=d(a)?a:o(a)?a.el:null)?(this.beforeInsert(),a.appendChild(this.el),this.onInsert(),this.emit("inserted"),this):this},beforeInsert:f,onInsert:f,remove:function(a){if(!this.el||!this.el.parentElement)return this;a=a||k(this.el,!0);var b=q(this.el);return m(b,"beforeRemove"),this.el.parentElement.removeChild(this.el),m(b,"onRemove"),this.emit("remove",null,a),this},beforeRemove:f,onRemove:f,destroy:function(){var a;return G[this._id]?(a=k(this.el,!0),this.remove(a),m(q(this.el),"beforeDestroy"),this.emit("destroy",null,a),this.el=null,G[this._id]=null,null):null},beforeDestroy:f,createRootElement:function(){return A.createElement(this.tagName)},find:function(a){return this.$el?this.$el.find(a):this.el?B.call(this.el.querySelectorAll(a)):[]},findComponent:function(a){return l(this.find("[is="+a+"]")[0])},findComponents:function(a){return D.call(this.find("[is="+a+"]"),l)},invoke:m,registerEvent:function(a,b,c){return 2===arguments.length&&(c=b,b=null),this._events.push([a,b,c]),this},releaseEvent:function(a,b,d){c(b)&&!d&&(d=b,b=null),c(d)||(d=null),"undefined"==typeof b&&(b=null),this._events=C.call(this._events,function(c){var e=c[0],f=c[1],g=c[2];return d?!(e===a&&f===b&&g===d):!(e===a&&f===b)})},setGlobalHandler:function(a,b){return H[a]=H[a]||[],H[a].push({fn:b,ctx:this}),this},releaseGlobalHandler:function(a,b){var c=H[a],d=this;return c?(H[a]=C.call(c,function(a){return a.fn!==b||a.ctx!==d}),this):this},scrollTo:function(){this.$el?window.scrollTo(0,this.$el.position().top):window.scrollTo(0,this.el.getBoundingClientRect().top+window.scrollY)}},{Component:y,init:u,bindEvents:t,handleEvent:p,parse:q,register:r,unregister:s,fromElement:l,isComponent:o,getInstancesOf:w,getInstanceOf:v,destroy:x}});